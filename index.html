<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Теннис с препятствиями</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #2f2f2f;
        }

        canvas {
            background-color: black;
        }
    </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="400"></canvas>

<script>
    // Получаем элемент canvas и контекст рисования
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Размеры мяча
    const ballRadius = 10;

    // Размеры ракеток
    const paddleWidth = 100;
    const paddleHeight = 10;

    // Позиции и скорости
    let ballX = canvas.width / 2;
    let ballY = canvas.height / 2;
    let ballSpeedX = 2;
    let ballSpeedY = 2;

    let playerPaddleX = (canvas.width - paddleWidth) / 2;
    let playerPaddleY = canvas.height - paddleHeight - 20;
    let playerSpeed = 0;

    let aiPaddleX = (canvas.width - paddleWidth) / 2;
    let aiSpeed = 6;

    let gameStarted = false;
    let countdown = 5;

    // Препятствия
    const obstacles = [];
    const numObstacles = 5;

    // Генерация препятствий
    function generateObstacles() {
        for (let i = 0; i < numObstacles; i++) {
            const obstacleWidth = 50;
            const obstacleHeight = 10;
            const x = Math.random() * (canvas.width - obstacleWidth);
            const y = Math.random() * (canvas.height - 100);  // Избегаем области ракеток
            obstacles.push({ x, y, width: obstacleWidth, height: obstacleHeight });
        }
    }

    // Рисуем препятствия
    function drawObstacles() {
        ctx.fillStyle = "#ffff00"; // Цвет препятствий
        obstacles.forEach(obstacle => {
            ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
        });
    }

    // Управление игроком
    document.addEventListener("keydown", (event) => {
        if (event.key === "ArrowLeft") {
            playerSpeed = -8;
        } else if (event.key === "ArrowRight") {
            playerSpeed = 8;
        }
    });

    document.addEventListener("keyup", (event) => {
        if (event.key === "ArrowLeft" || event.key === "ArrowRight") {
            playerSpeed = 0;
        }
    });

    // Функция рисования мяча
    function drawBall() {
        ctx.beginPath();
        ctx.arc(ballX, ballY, ballRadius, 0, Math.PI * 2);
        ctx.fillStyle = "#00ff00"; // Цвет мяча
        ctx.fill();
        ctx.closePath();
    }

    // Функция рисования ракетки игрока
    function drawPlayerPaddle() {
        ctx.beginPath();
        ctx.rect(playerPaddleX, playerPaddleY, paddleWidth, paddleHeight);
        ctx.fillStyle = "#ff0000"; // Цвет ракетки игрока
        ctx.fill();
        ctx.closePath();
    }

    // Функция рисования ракетки ИИ
    function drawAiPaddle() {
        ctx.beginPath();
        ctx.rect(aiPaddleX, 20, paddleWidth, paddleHeight);
        ctx.fillStyle = "#0000ff"; // Цвет ракетки ИИ
        ctx.fill();
        ctx.closePath();
    }

    // Функция для обновления игры
    function updateGame() {
        if (gameStarted) {
            // Двигаем мяч
            ballX += ballSpeedX;
            ballY += ballSpeedY;

            // Отражение мяча от стен
            if (ballX + ballRadius > canvas.width || ballX - ballRadius < 0) {
                ballSpeedX = -ballSpeedX;
            }
            if (ballY - ballRadius < 0) {
                ballSpeedY = -ballSpeedY;
            }

            // Проверка на попадание мяча в ракетку игрока
            if (ballY + ballRadius > playerPaddleY && ballY + ballRadius < playerPaddleY + paddleHeight && ballX > playerPaddleX && ballX < playerPaddleX + paddleWidth) {
                ballSpeedY = -ballSpeedY;
                ballSpeedX *= 1.05; // Увеличиваем скорость мяча
                ballSpeedY *= 1.05;
            }

            // Проверка на попадание мяча в ракетку ИИ
            if (ballY - ballRadius < 40 && ballY - ballRadius > 40 - paddleHeight && ballX > aiPaddleX && ballX < aiPaddleX + paddleWidth) {
                ballSpeedY = -ballSpeedY;
                ballSpeedX *= 1.05; // Увеличиваем скорость мяча
                ballSpeedY *= 1.05;
            }

            // Проверка на попадание мяча в препятствия
            obstacles.forEach(obstacle => {
                if (ballX + ballRadius > obstacle.x && ballX - ballRadius < obstacle.x + obstacle.width &&
                    ballY + ballRadius > obstacle.y && ballY - ballRadius < obstacle.y + obstacle.height) {
                    // Отскок мяча от препятствия
                    ballSpeedY = -ballSpeedY;
                    ballSpeedX = (ballX < obstacle.x + obstacle.width / 2) ? Math.abs(ballSpeedX) : -Math.abs(ballSpeedX);
                }
            });

            // Падение мяча (игрок проиграл)
            if (ballY + ballRadius > canvas.height) {
                alert("Вы проиграли! Попробуйте снова!");
                document.location.reload();
            }

            // Управление ракеткой игрока
            playerPaddleX += playerSpeed;
            if (playerPaddleX < 0) playerPaddleX = 0;
            if (playerPaddleX + paddleWidth > canvas.width) playerPaddleX = canvas.width - paddleWidth;

            // Ракетка ИИ — движется за мячом
            if (ballX < aiPaddleX + paddleWidth / 2) {
                aiPaddleX -= aiSpeed;
            } else if (ballX > aiPaddleX + paddleWidth / 2) {
                aiPaddleX += aiSpeed;
            }

            // Ограничиваем движение ИИ в пределах экрана
            if (aiPaddleX < 0) aiPaddleX = 0;
            if (aiPaddleX + paddleWidth > canvas.width) aiPaddleX = canvas.width - paddleWidth;

            // Рисуем все элементы
            drawBall();
            drawPlayerPaddle();
            drawAiPaddle();
            drawObstacles();
        } else {
            // Показываем отсчёт перед началом игры
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.font = "40px Arial";
            ctx.fillStyle = "#fff";
            if (countdown > 0) {
                ctx.fillText(`Начнется через ${countdown}`, canvas.width / 2 - 150, canvas.height / 2);
            } else {
                gameStarted = true;
                countdown = 5;
            }
        }
    }

    // Таймер отсчёта
    setInterval(function() {
        if (countdown > 0) {
            countdown--;
        }
    }, 1000);

    // Функция, которая будет запускаться каждый кадр
    function gameLoop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        updateGame();
        requestAnimationFrame(gameLoop);
    }

    // Генерация препятствий
    generateObstacles();

    // Запуск игры
    gameLoop();
</script>
</body>
</html>
